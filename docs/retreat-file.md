# retreat-file

## 功能描述

这是一个用于文件恢复的内核模块，在日常工作开发中，我们可能不小心删除了系统文件，例如系统库，这个时候，传统思路中没有提供办法来将他恢复，除非使用昂贵的数据恢复技术。本模块提供一个接口，能够尽可能的恢复被误删的系统文件（或其他文件），只要该文件仍在内存中被其他任意进程引用，它就能被本模块恢复。

## 使用方式

该模块安装后，会在系统提供一个`/dev/retreat-file`的文件节点，用户可以通过往该进程写入一个文件路径来尝试恢复指定路径的文件，该文件路径必须是绝对路径，若当前内存已经没有任何进程引用该文件时，写入操作将得到“查找不到文件”之类的报错，否则可以成功恢复。

模块不要求提前安装，也就是说，在文件被误删之后，再安装使用该模块也是可以正常工作的。

## 技术细节

当往 `/dev/retreat-file`写入一个文件绝对路径时，首先，模块会通过钩子拦截内核文件释放的函数，当识别到其释放的文件的路径与目标文件路径匹配时，暂不释放，由模块完成延迟释放，这么做的目的是，避免因查找该文件的过程中耗时过多，导致文件的内存目标已被释放；之后，本模块会去遍历所有进程的所有文件描述符，试图找到与该文件路径对应的文件内存对象，一旦找到，便可以将它进行原路径恢复。
